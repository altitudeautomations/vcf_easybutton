---
- name: Validate JSON
  hosts: localhost
  gather_facts: false
  vars_files:
    - ../../altnest_vars.yml
  tasks:
  - name: Validate JSON
    ansible.builtin.uri:
      url: "{{CB_URL}}/v1/sddcs"
      headers:
        Authorization: Basic 
        Content_Type: application/json
        Accept: application/json
      body: {"skipEsxThumbprintValidation":true,"managementPoolName":"{{sddc_netprof_1_name}}","sddcManagerSpec":{"secondUserCredentials":{"username":"vcf","password":"{{password_complex}}"},"ipAddress":"{{sddc_ip}}","netmask":"{{sddc_subnetmask}}","hostname":"{{sddc_hostname}}","licenseKey":"{{license_sddc}}","rootUserCredentials":{"username":"root","password":"{{password_simple}}"},"localUserPassword":"{{password_complex}}","vcenterId":"{{vc_mgmt_hostname}}"},"sddcId":"{{sddc_hostname}}","esxLicense":"{{license_esxi}}","taskName":"workflowconfig/workflowspec-ems.json","ceipEnabled":"{{set_ceip}}","fipsEnabled":"{{set_fips}}","ntpServers":["{{ntp_primary}}","{{ntp_secondary}}"],"dnsSpec":{"secondaryNameserver":"{{dns_secondary}}","subdomain":"{{dns_domain_child}}","domain":"{{dns_domain_child}}","nameserver":"{{dns_primary}}"},"networkSpecs":[{"networkType":"MANAGEMENT","subnet":"{{vc_mgmt_net_mgmt_subnet}}","gateway":"{{vc_mgmt_net_mgmt_gateway}}","vlanId":"{{vc_mgmt_net_mgmt_vlan}}","mtu":"{{vc_mgmt_net_mgmt_mtu}}","portGroupKey":"{{vc_mgmt_net_pg_name}}","standbyUplinks":[],"activeUplinks":["uplink1","uplink2"]},{"networkType":"VMOTION","subnet":"{{vc_mgmt_net_vmotion_subnet}}","gateway":"{{vc_mgmt_net_vmotion_gateway}}","vlanId":"{{vc_mgmt_net_vmotion_vlan}}","mtu":"{{vc_mgmt_net_vmotion_mtu}}","portGroupKey":"{{vc_mgmt_net_vmotion_pg_name}}","association":"{{vc_mgmt_datacenter_name}}","includeIpAddressRanges":[{"endIpAddress":"{{sddc_netprof_vmotion_ipend}}","startIpAddress":"{{sddc_netprof_vmotion_ipstart}}"}],"standbyUplinks":[],"activeUplinks":["uplink1","uplink2"]},{"networkType":"VSAN","subnet":"{{vc_mgmt_net_vsan_subnet}}","gateway":"{{vc_mgmt_net_vsan_gateway}}","vlanId":"{{vc_mgmt_net_vsan_vlan}}","mtu":"{{vc_mgmt_net_vsan_mtu}}","portGroupKey":"{{vc_mgmt_net_vsan_pg_name}}","includeIpAddressRanges":[{"endIpAddress":"{{sddc_netprof_vsan_ipend}}","startIpAddress":"{{sddc_netprof_vsan_ipstart}}"}],"standbyUplinks":[],"activeUplinks":["uplink1","uplink2"]}],"nsxtSpec":{"nsxtManagerSize":"{{mgmt_nsx_manager_nodesize}}","nsxtManagers":[{"hostname":"{{mgmt_nsx_manager_1_hostname}}","ip":"{{mgmt_nsx_manager_1_ip}}"},{"hostname":"{{mgmt_nsx_manager_2_hostname}}","ip":"{{mgmt_nsx_manager_2_ip}}"},{"hostname":"{{mgmt_nsx_manager_3_hostname}}","ip":"{{mgmt_nsx_manager_3_ip}}"}],"rootNsxtManagerPassword":"{{password_complex}}","nsxtAdminPassword":"{{password_complex}}","nsxtAuditPassword":"{{password_complex}}","rootLoginEnabledForNsxtManager":"true","sshEnabledForNsxtManager":"true","overLayTransportZone":{"zoneName":"{{mgmt_nsx_transportzone_overlay_name}}","networkName":"{{mgmt_nsx_transportzone_overlay_network_name}}"},"vlanTransportZone":{"zoneName":"{{mgmt_nsx_transportzone_vlan_name}}","networkName":"{{mgmt_nsx_transportzone_vlan_network_name}}"},"vip":"{{mgmt_nsx_vip_ip}}","vipFqdn":"{{mgmt_nsx_vip_fqdn}}","nsxtLicense":"{{license_nsx}}","transportVlanId":"{{vc_mgmt_net_htep_vlan}}","ipAddressPoolSpec":{"name":"{{mgmt_nsx_netprof_htep_name}}","description":"{{mgmt_nsx_netprof_htep_desc}}","subnets":[{"ipAddressPoolRanges":[{"start":"{{mgmt_nsx_netprof_htep_ipstart}}","end":"{{mgmt_nsx_netprof_htep_ipend}}"}],"cidr":"{{mgmt_nsx_netprof_htep_cidr}}","gateway":"{{vc_mgmt_net_htep_gateway}}"}]}},"vsanSpec":{"vsanName":"{{vsan_spec_name}}","licenseFile":"{{license_vsan}}","vsanDedup":"{{vc_mgmt_cl1_vsan_set_dedupe}}","datastoreName":"{{vc_mgmt_cl1_vsan_dsname}}"},"dvSwitchVersion":"{{vc_mgmt_vds1_version}}","dvsSpecs":[{"dvsName":"{{vc_mgmt_vds1_name}}","vcenterId":"{{vc_mgmt_vcenterid}}","vmnics":["{{vc_mgmt_vds1_pnic1}}","{{vc_mgmt_vds1_pnic2}}"],"mtu":"{{vc_mgmt_vds1_mtu}}","networks":["MANAGEMENT","VMOTION","VSAN"],"niocSpecs":[{"trafficType":"VSAN","value":"HIGH"},{"trafficType":"VMOTION","value":"LOW"},{"trafficType":"VDP","value":"LOW"},{"trafficType":"VIRTUALMACHINE","value":"HIGH"},{"trafficType":"MANAGEMENT","value":"NORMAL"},{"trafficType":"NFS","value":"LOW"},{"trafficType":"HBR","value":"LOW"},{"trafficType":"FAULTTOLERANCE","value":"LOW"},{"trafficType":"ISCSI","value":"LOW"}],"isUsedByNsxt":"{{vc_mgmt_vds1_isnsxt}}"}],"clusterSpec":{"clusterName":"{{vc_mgmt_cluster_name}}","vcenterName":"{{vc_spec_name}}","clusterEvcMode":"{{vc_mgmt_evcmode}}","vmFolders":{"MANAGEMENT":"{{vc_mgmt_folder_mgmt}}","NETWORKING":"{{vc_mgmt_folder_nsx}}","EDGENODES":"{{vc_mgmt_folder_edge}}"},"resourcePoolSpecs":[{"name":"{{vc_mgmt_respool_sddc_mgmt}}","type":"management","cpuReservationPercentage":0,"cpuLimit":-1,"cpuReservationExpandable":true,"cpuSharesLevel":"normal","cpuSharesValue":0,"memoryReservationMb":0,"memoryLimit":-1,"memoryReservationExpandable":true,"memorySharesLevel":"normal","memorySharesValue":0},{"name":"{{vc_mgmt_respool_sddc_edge}}","type":"network","cpuReservationPercentage":0,"cpuLimit":-1,"cpuReservationExpandable":true,"cpuSharesLevel":"normal","cpuSharesValue":0,"memoryReservationPercentage":0,"memoryLimit":-1,"memoryReservationExpandable":true,"memorySharesLevel":"normal","memorySharesValue":0},{"name":"{{vc_mgmt_respool_usr_edge}}","type":"compute","cpuReservationPercentage":0,"cpuLimit":-1,"cpuReservationExpandable":true,"cpuSharesLevel":"normal","cpuSharesValue":0,"memoryReservationPercentage":0,"memoryLimit":-1,"memoryReservationExpandable":true,"memorySharesLevel":"normal","memorySharesValue":0},{"name":"{{vc_mgmt_respool_usr_vm}}","type":"compute","cpuReservationPercentage":0,"cpuLimit":-1,"cpuReservationExpandable":true,"cpuSharesLevel":"normal","cpuSharesValue":0,"memoryReservationPercentage":0,"memoryLimit":-1,"memoryReservationExpandable":true,"memorySharesLevel":"normal","memorySharesValue":0}]},"pscSpecs":[{"pscId":"{{psc_spec_name}}","vcenterId":"{{vc_spec_name}}","adminUserSsoPassword":"{{password_simple}}","pscSsoSpec":{"ssoDomain":"vsphere.local"}}],"vcenterSpec":{"vcenterIp":"{{vc_mgmt_ip}}","vcenterHostname":"{{vc_mgmt_hostname}}","vcenterId":"{{vc_spec_name}}","licenseFile":"{{license_vc}}","vmSize":"{{vc_mgmt_vmsize}}","storageSize":"{{vc_mgmt_storagesize}}","rootVcenterPassword":"{{password_simple}}"},"hostSpecs":[{"association":"{{vc_mgmt_datacenter_name}}","ipAddressPrivate":{"ipAddress":"{{vc_mgmt_esx1_mgmt_ip}}"},"hostname":"{{vc_mgmt_esx1_hostname}}","credentials":{"username":"root","password":"{{password_simple}}"},"vSwitch":"{{mgmt_esx_vss_name}}","serverId":"{{vc_mgmt_esx1_id}}"},{"association":"{{vc_mgmt_datacenter_name}}","ipAddressPrivate":{"ipAddress":"{{vc_mgmt_esx2_mgmt_ip}}"},"hostname":"{{vc_mgmt_esx2_hostname}}","credentials":{"username":"root","password":"{{password_simple}}"},"vSwitch":"{{mgmt_esx_vss_name}}","serverId":"{{vc_mgmt_esx2_id}}"},{"association":"{{vc_mgmt_datacenter_name}}","ipAddressPrivate":{"ipAddress":"{{vc_mgmt_esx3_mgmt_ip}}"},"hostname":"{{vc_mgmt_esx3_hostname}}","credentials":{"username":"root","password":"{{password_simple}}"},"vSwitch":"{{mgmt_esx_vss_name}}","serverId":"{{vc_mgmt_esx3_id}}"},{"association":"{{vc_mgmt_datacenter_name}}","ipAddressPrivate":{"ipAddress":"{{vc_mgmt_esx4_mgmt_ip}}"},"hostname":"{{vc_mgmt_esx4_hostname}}","credentials":{"username":"root","password":"{{password_simple}}"},"vSwitch":"{{mgmt_esx_vss_name}}","serverId":"{{vc_mgmt_esx4_id}}"}],"excludedComponents":["AVN","EBGP"]}
      method: POST
      status_code: [200, 202]
      body_format: json
      validate_certs: no